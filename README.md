# My Bible Plugin - إضافة الكتاب المقدس المحسنة

## نظرة عامة

إضافة WordPress متقدمة لعرض الكتاب المقدس باللغة العربية مع مزايا متطورة للبحث والتفاعل وتحسين محركات البحث.

## الإصلاحات والتحسينات الجديدة (v2.4.0)

### 🔒 **إصلاحات الأمان**
- **إصلاح SQL Injection**: تم إصلاح الثغرة الأمنية في دالة `my_bible_get_book_order_from_db()` 
- **تطهير المدخلات**: تحسين تطهير جميع المدخلات من المستخدمين
- **استعلامات آمنة**: استخدام `$wpdb->prepare()` بشكل صحيح في جميع الاستعلامات

### 📖 **تحسين نظام القاموس**
- **متاح للجميع**: نظام قاموس الكلمات يعمل الآن مع جميع الزوار وليس المسجلين فقط
- **AJAX محسن**: إضافة endpoint جديد `bible_get_chapter_terms` للحصول على معاني الكلمات
- **واجهة محسنة**: تحسين عرض القاموس مع رسائل خطأ واضحة وتأثيرات بصرية

### 🔍 **تحسين SEO ومحركات البحث**
- **Meta Tags شاملة**: إضافة Open Graph و Twitter Cards لكل آية وأصحاح
- **Schema.org**: بيانات منظمة لمحركات البحث
- **URL كانونية**: روابط معيارية لتجنب المحتوى المكرر  
- **Breadcrumbs**: مسار التنقل المنظم
- **عناوين ديناميكية**: عناوين محسنة لكل صفحة
- **أرشفة محسنة**: robots meta tags للفهرسة الصحيحة

### 🛠 **تحسينات JavaScript**
- **دالة التشكيل محسنة**: إزالة شاملة لجميع رموز التشكيل العربية
- **معالجة المحتوى الديناميكي**: دعم أفضل للمحتوى المحمل عبر AJAX
- **MutationObserver**: مراقبة التغييرات في DOM تلقائياً
- **Debounce**: تحسين أداء معالجة الأحداث
- **Error Handling**: معالجة أخطاء محسنة في JavaScript

### 🚀 **تحسين قاعدة البيانات**
- **فهارس محسنة**: إضافة فهارس متقدمة للبحث السريع
- **FULLTEXT Search**: بحث نصي محسن في الآيات والقاموس
- **تخزين مؤقت**: نظام cache متقدم للاستعلامات
- **تحسين يومي**: مهام مجدولة لتحسين الجداول
- **إحصائيات**: معلومات مفصلة عن قاعدة البيانات

### 🌐 **تحسين الترجمة**
- **ملفات اللغة**: إضافة ملف الترجمة العربية الكامل
- **نصوص قابلة للترجمة**: استخدام دوال الترجمة في جميع النصوص
- **دعم متعدد اللغات**: بنية جاهزة للترجمة المستقبلية

### ⚠️ **معالجة الأخطاء المحسنة**
- **تسجيل متقدم**: نظام شامل لتسجيل الأخطاء مع التفاصيل
- **رسائل واضحة**: رسائل خطأ مفهومة للمستخدمين
- **لوحة إدارية**: صفحة إدارية لمراجعة الأخطاء
- **تنظيف تلقائي**: حذف السجلات القديمة تلقائياً
- **تنبيهات إدارية**: إشعارات للمدراء عند وجود أخطاء

## المزايا الأساسية

### 📚 **عرض الكتاب المقدس**
- عرض النصوص باللغة العربية
- تنقل سهل بين الأسفار والأصحاحات
- فلترة بحسب العهد (القديم/الجديد)
- روابط مباشرة لكل آية

### 🔍 **البحث المتقدم** 
- بحث نصي شامل في جميع الآيات
- بحث بالكلمات المفتاحية
- فلترة النتائج بحسب العهد
- ترتيب النتائج بحسب الصلة

### 📖 **قاموس الكلمات**
- شرح معاني الكلمات المهمة
- روابط تفاعلية في النصوص
- عرض جميع معاني كلمات الأصحاح
- بحث في القاموس

### 🎨 **مزايا العرض**
- **الوضع الليلي**: تبديل سهل بين الوضعين
- **التحكم في الخط**: تكبير وتصغير النص
- **التشكيل**: إظهار أو إخفاء التشكيل العربي
- **القراءة الصوتية**: قراءة النصوص بصوت عالٍ

### 📱 **تصميم متجاوب**
- يعمل على جميع الأجهزة
- واجهة سهلة الاستخدام
- تحميل سريع
- تجربة مستخدم محسنة

### 🖼️ **إنشاء الصور**
- إنشاء صور للآيات للمشاركة
- خيارات خطوط متعددة
- خلفيات متنوعة
- تحميل مباشر للصور

## المتطلبات

- WordPress 5.0 أو أحدث
- PHP 7.4 أو أحدث
- MySQL 5.7 أو أحدث (للبحث FULLTEXT)

## التثبيت

1. ارفع ملفات الإضافة إلى مجلد `/wp-content/plugins/my-bible-plugin/`
2. فعّل الإضافة من لوحة إدارة WordPress
3. اذهب إلى الإعدادات > الكتاب المقدس لضبط الإعدادات
4. ستتم إضافة صفحة "الكتاب المقدس" تلقائياً

## الاستخدام

### Shortcodes المتاحة

```php
// عرض الكتاب المقدس الكامل
[bible_content]

// عرض سفر محدد
[bible_content book="سفر التكوين"]

// عرض أصحاح محدد
[bible_content book="سفر التكوين" chapter="1"]

// عرض عهد محدد
[bible_content testament="العهد الجديد"]
```

### URLs المخصصة

```
/bible/                     - الصفحة الرئيسية
/bible/سفر-التكوين/        - سفر التكوين
/bible/سفر-التكوين/1/      - الأصحاح الأول
/bible/سفر-التكوين/1/1/    - الآية الأولى
```

## البنية التقنية

### ملفات الإضافة

```
my-bible-plugin/
├── my-bible-plugin.php          # الملف الرئيسي
├── includes/
│   ├── helpers.php              # الدوال المساعدة
│   ├── ajax.php                 # معالجات AJAX
│   ├── templates.php            # قوالب العرض
│   ├── shortcodes.php           # رموز الاختصار
│   ├── rewrite.php              # قواعد إعادة الكتابة
│   ├── sitemap.php              # خريطة الموقع
│   ├── seo.php                  # تحسين محركات البحث
│   ├── database-optimization.php # تحسين قاعدة البيانات
│   └── error-handling.php       # معالجة الأخطاء
├── assets/
│   ├── css/
│   │   ├── bible-styles.css     # تنسيقات عامة
│   │   └── dark-mode.css        # تنسيقات الوضع الليلي
│   └── js/
│       ├── bible-frontend.js    # JavaScript الأساسي
│       ├── bible-dictionary-enhanced.js  # القاموس المحسن
│       └── bible-dynamic-content.js      # المحتوى الديناميكي
└── languages/
    └── my-bible-plugin-ar.po    # ملف الترجمة العربية
```

### جداول قاعدة البيانات

#### `wp_bible_verses`
- `id`: معرف الآية
- `testament`: العهد
- `book`: السفر  
- `chapter`: الأصحاح
- `verse`: رقم الآية
- `text`: نص الآية
- `translation_code`: رمز الترجمة
- فهارس محسنة للبحث السريع

#### `wp_my_bible_dictionary`
- `id`: معرف المصطلح
- `term`: الكلمة
- `definition`: التعريف
- `category`: التصنيف
- فهرس FULLTEXT للبحث السريع

## API Functions

### دوال PHP المتاحة

```php
// البحث المحسن
my_bible_optimized_search($search_term, $testament, $limit, $offset);

// جلب آيات الأصحاح
my_bible_get_chapter_verses_optimized($book_name, $chapter, $translation);

// إحصائيات قاعدة البيانات
my_bible_get_database_stats();

// البحث في القاموس
my_bible_search_dictionary_optimized($search_term, $limit);

// تسجيل الأخطاء
my_bible_enhanced_log_error($message, $context, $severity, $additional_data);
```

### AJAX Endpoints

```javascript
// جلب الأسفار بحسب العهد
wp_ajax_bible_get_books_by_testament

// جلب الأصحاحات
wp_ajax_bible_get_chapters  

// جلب الآيات
wp_ajax_bible_get_verses

// جلب معاني الكلمات (جديد)
wp_ajax_bible_get_chapter_terms
```

## الإعدادات

### الإعدادات العامة
- **سفر الآيات العشوائية**: تحديد سفر للآيات العشوائية
- **الوضع الليلي الافتراضي**: تفعيل الوضع الليلي للزوار الجدد
- **العهد الافتراضي**: اختيار العهد المعروض افتراضياً

### إعدادات قاعدة البيانات
- تحسين تلقائي يومي للجداول
- تنظيف السجلات القديمة
- فهارس محسنة للبحث

## الأمان

### التدابير المطبقة
- ✅ حماية من SQL Injection  
- ✅ تطهير جميع المدخلات
- ✅ التحقق من الصلاحيات
- ✅ استخدام nonces في AJAX
- ✅ تشفير البيانات الحساسة

## الأداء

### تحسينات الأداء
- ✅ فهارس قاعدة البيانات محسنة
- ✅ تخزين مؤقت للاستعلامات
- ✅ ضغط ملفات CSS و JS
- ✅ تحميل البيانات حسب الطلب
- ✅ MutationObserver للتحديثات الديناميكية

## استكشاف الأخطاء

### سجل الأخطاء
- اذهب إلى الإعدادات > سجل الأخطاء
- راجع الأخطاء الحديثة مع التفاصيل
- إمكانية مسح السجل

### تفعيل التسجيل
```php
// في wp-config.php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

## الدعم والتطوير

### تطوير مستقبلي
- [ ] إضافة ترجمات متعددة للكتاب المقدس
- [ ] دعم اللغات الأخرى
- [ ] تطبيق الجوال المصاحب
- [ ] تحليلات الاستخدام
- [ ] مشاركة الآيات على وسائل التواصل

### المساهمة
نرحب بالمساهمات لتطوير الإضافة:
1. Fork المشروع
2. أنشئ branch للميزة الجديدة
3. اختبر التغييرات
4. أرسل Pull Request

## الترخيص

هذه الإضافة مرخصة تحت GPL v2 أو أحدث.

## الإصدارات

### v2.4.0 (الحالي)
- إصلاحات الأمان المهمة
- تحسين نظام القاموس  
- تحسين SEO شامل
- تحسينات قاعدة البيانات
- معالجة أخطاء محسنة

### v2.3.0
- إضافة الوضع الليلي
- تحسين البحث
- إنشاء الصور

### v2.2.0  
- قاموس الكلمات
- تحسين التنقل
- الآيات العشوائية

---

**ملاحظة**: تأكد من عمل نسخة احتياطية من قاعدة البيانات قبل التحديث إلى إصدار جديد.